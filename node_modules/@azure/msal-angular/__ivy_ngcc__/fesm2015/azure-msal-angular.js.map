{"version":3,"file":"azure-msal-angular.js","sources":["../../src/constants.ts","../../src/msal.service.ts","../../src/msal.guard.ts","../../src/msal.interceptor.ts","../../src/msal.broadcast.service.ts","../../src/msal.module.ts","../../src/public-api.ts","../../src/azure-msal-angular.ts"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;;AACA,MAGa,aAAa,GAAG,IAAI,cAAc,CAAS,eAAe,EAAE;AACzE,MACa,iBAAiB,GAAG,IAAI,cAAc,CAAS,mBAAmB,EAAE;AACjF,MACa,uBAAuB,GAAG,IAAI,cAAc,CAAS,yBAAyB,EAAE;AAEtF,MAAM,IAAI,GAAG,qBAAqB,CAAC;AAEnC,MAAM,OAAO,GAAG,eAAe;AACtC;AChBA;AACA;AACA;AACA;AACA,MAkBa,WAAW;AAAG,IAIvB,YACkC,QAAkC,EACxD,QAAkB;AAC/B,QAFmC,aAAQ,GAAR,QAAQ,CAA0B;AAAC,QACzD,aAAQ,GAAR,QAAQ,CAAU;AAClC,QACQ,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,EAAE,CAAC;AAC/D,QAAQ,IAAI,IAAI,EAAE;AAClB,YAAY,IAAI,CAAC,YAAY,GAAG,IAAI,IAAI,EAAE,CAAC;AAC3C,SAAS;AACT,KAAK;AACL,IACI,iBAAiB,CAAC,OAAqB;AAAI,QACvC,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC,CAAC;AAC9D,KAAK;AACL,IAAI,oBAAoB,CAAC,OAAwB;AAAI,QAC7C,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC,CAAC;AACjE,KAAK;AACL,IAAI,kBAAkB,CAAC,aAA4B;AAAI,QAC/C,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,aAAa,CAAC,CAAC,CAAC;AACrE,KAAK;AACL,IAAI,wBAAwB;AAAK,QACzB,MAAM,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;AAC5F,QAAQ,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;AAC/B,QAAQ,OAAO,cAAc,CAAC;AAC9B,KAAK;AACL,IAAI,UAAU,CAAC,OAAsB;AAAI,QACjC,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;AACvD,KAAK;AACL,IAAI,aAAa,CAAC,OAAyB;AAAI,QACvC,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC;AAC1D,KAAK;AACL,IAAI,MAAM,CAAC,aAAiC;AAAI,QACxC,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC,CAAC;AACzD,KAAK;AACL,IAAI,SAAS,CAAC,OAAyB;AAAI,QACnC,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;AACtD,KAAK;AACL,IAAI,SAAS;AAAK,QACV,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE;AAC1B,YAAY,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;AACzE,SAAS;AACT,QAAQ,OAAO,IAAI,CAAC,MAAM,CAAC;AAC3B,KAAK;AACL,IAAI,SAAS,CAAC,MAAc;AAAI,QACxB,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;AAClD,QAAQ,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;AACxC,KAAK;AACL;uCAnDC,UAAU;iGACT;AAAC;AAAqC,4CAK/B,MAAM,SAAC,aAAa;AAAS,YArB7B,QAAQ;AAAG;;;;;;6DAAE;AAAC;ACNvB;AACA;AACA;AACA;AACA,MAYa,SAAS;AAAG,IACrB,YACuC,eAAuC,EAClE,WAAwB,EACxB,QAAkB;AAChC,QAHyC,oBAAe,GAAf,eAAe,CAAwB;AAAC,QACnE,gBAAW,GAAX,WAAW,CAAa;AAAC,QACzB,aAAQ,GAAR,QAAQ,CAAU;AAAC,KAC1B;AACT;AACO;AACgD;AACL;AACd;AAC7B,IACH,iBAAiB,CAAC,IAAY;AAAI,QAC9B,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,iCAAiC,CAAC,CAAC;AAChF;AACA,QAAQ,MAAM,YAAY,GAAG,QAAQ,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC;AACnE,QAAQ,MAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY,CAAC,MAAM,GAAG,YAAY,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;AACrH;AAC+D,QACvD,MAAM,OAAO,GAAG,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC;AAC/D;AACiC,QACzB,IAAI,OAAO,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE;AACrC,YAAY,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,qCAAqC,CAAC,CAAC;AACxF,YAAY,OAAO,GAAG,OAAO,IAAI,OAAO,EAAE,CAAC;AAC3C,SAAS;AACT;AACU;AAC+G;AACvC;AACvE,QACH,OAAO,GAAG,OAAO,GAAG,IAAI,EAAE,CAAC;AACnC,KAAK;AACL,IACY,kBAAkB,CAAC,GAAW;AAAI,QACtC,IAAI,IAAI,CAAC,eAAe,CAAC,eAAe,KAAK,eAAe,CAAC,KAAK,EAAE;AAC5E,YAAY,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,6BAA6B,CAAC,CAAC;AAChF,YAAY,OAAO,IAAI,CAAC,WAAW,CAAC,UAAU,mBAAM,IAAI,CAAC,eAAe,CAAC,WAAW,EAAG;AACvF,iBAAiB,IAAI,CACD,GAAG,CAAC;AACxB,gBAAwB,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,iDAAiD,CAAC,CAAC;AAChH,gBAAwB,OAAO,IAAI,CAAC;AACpC,aAAqB,CAAC,EACF,UAAU,CAAC,MAAM,EAAE,CAAC,KAAK,CAAC,CAAC,CAC9B,CAAC;AAClB,SAAS;AACT,QACQ,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,gCAAgC,CAAC,CAAC;AAC/E,QAAQ,MAAM,iBAAiB,GAAG,IAAI,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC;AAC9D,QAAQ,IAAI,CAAC,WAAW,CAAC,aAAa,iBAC1B,iBAAiB,IACd,IAAI,CAAC,eAAe,CAAC,WAAW,EACrC,CAAC;AACX,QAAQ,OAAO,EAAE,CAAC,KAAK,CAAC,CAAC;AACzB,KAAK;AACL,IACI,WAAW,CAAC,KAA6B,EAAE,KAA0B;AAAI,QACrE,IAAI,IAAI,CAAC,eAAe,CAAC,eAAe,KAAK,eAAe,CAAC,KAAK,IAAI,IAAI,CAAC,eAAe,CAAC,eAAe,KAAK,eAAe,CAAC,QAAQ,EAAE;AACjJ,YAAY,MAAM,IAAI,6BAA6B,CAAC,0BAA0B,EAAE,mJAAmJ,CAAC,CAAC;AACrO,SAAS;AACT,QAAQ,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC;AACrE;AACU;AACyE;AACzB;AACkC;AACjF,QACH,IAAI,SAAS,CAAC,2BAA2B,CAAC,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,YAAY,CAAC,UAAU,EAAE,EAAE;AACtG,YAAY,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,mIAAmI,CAAC,CAAC;AACtL,YAAY,OAAO,EAAE,CAAC,KAAK,CAAC,CAAC;AAC7B,SAAS;AACT,QACQ,OAAO,IAAI,CAAC,WAAW,CAAC,wBAAwB,EAAE;AAC1D,aAAa,IAAI,CACD,SAAS,CAAC;AAC1B,YAAoB,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC,MAAM,EAAE;AAC5E,gBAAwB,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,4DAA4D,CAAC,CAAC;AAC3H,gBAAwB,OAAO,IAAI,CAAC,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AAClE,aAAqB;AACrB,YAAoB,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,yCAAyC,CAAC,CAAC;AACpG,YAAoB,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;AACpC,SAAiB,CAAC,EACF,UAAU,CAAC;AAC3B,YAAoB,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,oDAAoD,CAAC,CAAC;AAC/G,YAAoB,OAAO,EAAE,CAAC,KAAK,CAAC,CAAC;AACrC,SAAiB,CAAC,CACL,CAAC;AACd,KAAK;AACL;qCAzFC,UAAU;2FACT;AAAC;AAAmC,4CAE7B,MAAM,SAAC,iBAAiB;AAAS,YAZjC,WAAW;AAAI,YAEf,QAAQ;AAAG;;;;;;oFAAE;AAAC;ACRvB;AACA;AACA;AACA;AACA,MAgBa,eAAe;AAAG,IAC3B,YAC6C,qBAAmD,EACpF,WAAwB;AACrC,QAF8C,0BAAqB,GAArB,qBAAqB,CAA8B;AAAC,QACrF,gBAAW,GAAX,WAAW,CAAa;AACxC,KAAQ;AACR,IACI,SAAS,CAAC,GAAqB,EAAE,IAAiB;AAAI,QAClD,IAAI,IAAI,CAAC,qBAAqB,CAAC,eAAe,KAAK,eAAe,CAAC,KAAK,IAAI,IAAI,CAAC,qBAAqB,CAAC,eAAe,KAAK,eAAe,CAAC,QAAQ,EAAE;AAC7J,YAAY,MAAM,IAAI,6BAA6B,CAAC,0BAA0B,EAAE,6JAA6J,CAAC,CAAC;AAC/O,SAAS;AACT,QACQ,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,4BAA4B,CAAC,CAAC;AAC3E,QAAQ,MAAM,MAAM,GAAG,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AAC1D,QAAQ,MAAM,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,cAAc,EAAE,CAAC,CAAC,CAAC,CAAC;AACtE,QACQ,IAAI,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE;AAC5C,YAAY,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,sCAAsC,CAAC,CAAC;AACzF,YAAY,OAAO,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACpC,SAAS;AACT;AACyG,QACjG,OAAO,IAAI,CAAC,WAAW,CAAC,kBAAkB,iCAAK,IAAI,CAAC,qBAAqB,CAAC,WAAW,KAAE,MAAM,EAAE,OAAO,IAAE;AAChH,aAAa,IAAI,CACD,UAAU,CAAC;AAC3B,YAAoB,IAAI,IAAI,CAAC,qBAAqB,CAAC,eAAe,KAAK,eAAe,CAAC,KAAK,EAAE;AAC9F,gBAAwB,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,kEAAkE,CAAC,CAAC;AACjI,gBAAwB,OAAO,IAAI,CAAC,WAAW,CAAC,iBAAiB,iCAAK,IAAI,CAAC,qBAAqB,CAAC,WAAW,KAAE,MAAM,IAAE,CAAC;AACvH,aAAqB;AACrB,YAAoB,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,qEAAqE,CAAC,CAAC;AAChI,YAAoB,MAAM,iBAAiB,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC;AACnE,YAAoB,IAAI,CAAC,WAAW,CAAC,oBAAoB,iCAAK,IAAI,CAAC,qBAAqB,CAAC,WAAW,KAAE,MAAM,EAAE,iBAAiB,IAAE,CAAC;AAClI,YAAoB,OAAO,KAAK,CAAC;AACjC,SAAiB,CAAC,EACF,SAAS,CAAC,CAAC,MAA4B;AACvD,YAAoB,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,6CAA6C,CAAC,CAAC;AACxG,YAAoB,MAAM,OAAO,GAAG,GAAG,CAAC,OAAO;AAC/C,iBAAyB,GAAG,CAAC,eAAe,EAAE,UAAU,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;AAC9E,YACoB,MAAM,YAAY,GAAG,GAAG,CAAC,KAAK,CAAC,EAAC,OAAO,EAAC,CAAC,CAAC;AAC9D,YAAoB,OAAO,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;AACrD,SAAiB,CAAC,CACL,CAAC;AACd,KACK;AACL,IACY,oBAAoB,CAAC,QAAgB;AAAI,QAC7C,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE,CAAC,OAAO,CAAC,2CAA2C,CAAC,CAAC;AAC1F,QAAQ,MAAM,uBAAuB,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,oBAAoB,CAAC,IAAI,EAAE,CAAC,CAAC;AAC3G,QAAQ,MAAM,uBAAuB,GAAG,uBAAuB,CAAC,MAAM,CAAC,GAAG;AAC1E,YAAY,OAAO,WAAW,CAAC,YAAY,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;AAC3D,SAAS,CAAC,CAAC;AACX;AAC8E,QACtE,IAAI,uBAAuB,CAAC,MAAM,GAAG,CAAC,EAAE;AAChD,YAAY,MAAM,cAAc,GAAG,uBAAuB,CAAC,CAAC,CAAC,CAAC;AAC9D,YAAY,IAAI,cAAc,EAAE;AAChC,gBAAgB,OAAO,IAAI,CAAC,qBAAqB,CAAC,oBAAoB,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;AAC3F,aAAa;AACb,SAAS;AACT,QACQ,OAAO,IAAI,CAAC;AACpB,KAAK;AACL;2CA/DC,UAAU;6GACT;AAAC;AAAyC,4CAEnC,MAAM,SAAC,uBAAuB;AAAS,YATvC,WAAW;AAAG;;;;;;yDAAE;AAAC;ACb1B;AACA;AACA;AACA;AACA,MAOa,oBAAoB;AACjC,IAGI,YACmC,YAAsC;AAC1E,QADoC,iBAAY,GAAZ,YAAY,CAA0B;AAC7E,QACQ,IAAI,CAAC,YAAY,GAAG,IAAI,OAAO,EAAgB,CAAC;AACxD,QAAQ,IAAI,CAAC,YAAY,GAAI,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,CAAC;AAC9D,QAAQ,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,CAAC,OAAqB;AACjE,YAAY,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC5C,SAAS,CAAC,CAAC;AACX,KAAK;AACL;gDAdC,UAAU;4HACT;AAAC;AACU,4CAIJ,MAAM,SAAC,aAAa;AAAQ;;;;;;kCAAE;AAAC;AChBxC;AACA;AACA;AACA;AACA,MAqBa,UAAU;AACvB,IAAI,OAAO,OAAO,CACV,YAAsC,EACtC,WAAmC,EACnC,iBAA+C;AACpD,QACK,OAAO;AACf,YAAY,QAAQ,EAAE,UAAU;AAChC,YAAY,SAAS,EAAE;AACvB,gBAAgB;AAChB,oBAAoB,OAAO,EAAE,aAAa;AAC1C,oBAAoB,QAAQ,EAAE,YAAY;AAC1C,iBAAiB;AACjB,gBAAgB;AAChB,oBAAoB,OAAO,EAAE,iBAAiB;AAC9C,oBAAoB,QAAQ,EAAE,WAAW;AACzC,iBAAiB;AACjB,gBAAgB;AAChB,oBAAoB,OAAO,EAAE,uBAAuB;AACpD,oBAAoB,QAAQ,EAAE,iBAAiB;AAC/C,iBAAiB;AACjB,gBAAgB,WAAW;AAC3B,aAAa;AACb,SAAS,CAAC;AACV,KAAK;AACL;sCAnCC,QAAQ,SAAC;QACN,YAAY,EAAE,EAAE,kBAChB,OAAO,EAAE,sBACL,YAAY,kBACf,kBACD,SAAS,EAAE;;CACP,SAAS;GACT;IAAoB,kBACvB;WACJ;;;;;;;;;;;;;;0BACI;AAAC;ACzBN;AACA;AACA;AACA;AACA;ACJA;AACA;AACA;AACA;AACA;AACmH","sourcesContent":["/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { InjectionToken } from \"@angular/core\";\r\n\r\nexport const MSAL_INSTANCE = new InjectionToken<string>(\"MSAL_INSTANCE\");\r\n\r\nexport const MSAL_GUARD_CONFIG = new InjectionToken<string>(\"MSAL_GUARD_CONFIG\");\r\n\r\nexport const MSAL_INTERCEPTOR_CONFIG = new InjectionToken<string>(\"MSAL_INTERCEPTOR_CONFIG\");\r\n\r\nexport const name = \"@azure/msal-angular\";\r\n\r\nexport const version = \"2.0.0-alpha.0\";\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { Inject, Injectable } from \"@angular/core\";\r\nimport { Location } from \"@angular/common\";\r\nimport {\r\n    IPublicClientApplication,\r\n    EndSessionRequest,\r\n    AuthenticationResult,\r\n    RedirectRequest,\r\n    SilentRequest,\r\n    PopupRequest,\r\n    SsoSilentRequest,\r\n    Logger\r\n} from \"@azure/msal-browser\";\r\nimport { MSAL_INSTANCE, name, version } from \"./constants\";\r\nimport { Observable, from } from \"rxjs\";\r\nimport { IMsalService } from \"./IMsalService\";\r\n\r\n@Injectable()\r\nexport class MsalService implements IMsalService {\r\n    private redirectHash: string;\r\n    private logger: Logger;\r\n\r\n    constructor(\r\n        @Inject(MSAL_INSTANCE) public instance: IPublicClientApplication,\r\n        private location: Location\r\n    ) {\r\n        const hash = this.location.path(true).split(\"#\").pop();\r\n        if (hash) {\r\n            this.redirectHash = `#${hash}`;\r\n        }\r\n    }\r\n\r\n    acquireTokenPopup(request: PopupRequest): Observable<AuthenticationResult> {\r\n        return from(this.instance.acquireTokenPopup(request));\r\n    }\r\n    acquireTokenRedirect(request: RedirectRequest): Observable<void> {\r\n        return from(this.instance.acquireTokenRedirect(request));\r\n    }\r\n    acquireTokenSilent(silentRequest: SilentRequest): Observable<AuthenticationResult> {\r\n        return from(this.instance.acquireTokenSilent(silentRequest));\r\n    }\r\n    handleRedirectObservable(): Observable<AuthenticationResult> {\r\n        const handleRedirect = from(this.instance.handleRedirectPromise(this.redirectHash));\r\n        this.redirectHash = \"\";\r\n        return handleRedirect;\r\n    }\r\n    loginPopup(request?: PopupRequest): Observable<AuthenticationResult> {\r\n        return from(this.instance.loginPopup(request));\r\n    }\r\n    loginRedirect(request?: RedirectRequest): Observable<void> {\r\n        return from(this.instance.loginRedirect(request));\r\n    }\r\n    logout(logoutRequest?: EndSessionRequest): Observable<void> {\r\n        return from(this.instance.logout(logoutRequest));\r\n    }\r\n    ssoSilent(request: SsoSilentRequest): Observable<AuthenticationResult> {\r\n        return from(this.instance.ssoSilent(request));\r\n    }\r\n    getLogger(): Logger {\r\n        if (!this.logger) {\r\n            this.logger = this.instance.getLogger().clone(name, version);\r\n        }\r\n        return this.logger;\r\n    }\r\n    setLogger(logger: Logger): void {\r\n        this.logger = logger.clone(name, version);\r\n        this.instance.setLogger(logger);\r\n    }\r\n\r\n}\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { CanActivate, ActivatedRouteSnapshot, RouterStateSnapshot } from \"@angular/router\";\r\nimport { MsalService } from \"./msal.service\";\r\nimport { Injectable, Inject } from \"@angular/core\";\r\nimport { Location } from \"@angular/common\";\r\nimport { InteractionType, BrowserConfigurationAuthError, BrowserUtils, UrlString } from \"@azure/msal-browser\";\r\nimport { MsalGuardConfiguration } from \"./msal.guard.config\";\r\nimport { MSAL_GUARD_CONFIG } from \"./constants\";\r\nimport { concatMap, catchError, map } from \"rxjs/operators\";\r\nimport { Observable, of } from \"rxjs\";\r\n\r\n@Injectable()\r\nexport class MsalGuard implements CanActivate {\r\n    constructor(\r\n        @Inject(MSAL_GUARD_CONFIG) private msalGuardConfig: MsalGuardConfiguration,\r\n        private authService: MsalService,\r\n        private location: Location,\r\n    ) { }\r\n\r\n    /**\r\n     * Builds the absolute url for the destination page\r\n     * @param path Relative path of requested page\r\n     * @returns Full destination url\r\n     */\r\n    getDestinationUrl(path: string): string {\r\n        this.authService.getLogger().verbose(\"Guard - getting destination url\");\r\n        // Absolute base url for the application (default to origin if base element not present)\r\n        const baseElements = document.getElementsByTagName(\"base\");\r\n        const baseUrl = this.location.normalize(baseElements.length ? baseElements[0].href : window.location.origin);\r\n\r\n        // Path of page (including hash, if using hash routing)\r\n        const pathUrl = this.location.prepareExternalUrl(path);\r\n\r\n        // Hash location strategy\r\n        if (pathUrl.startsWith(\"#\")) {\r\n            this.authService.getLogger().verbose(\"Guard - destination by hash routing\");\r\n            return `${baseUrl}/${pathUrl}`;\r\n        }\r\n\r\n        /*\r\n         * If using path location strategy, pathUrl will include the relative portion of the base path (e.g. /base/page).\r\n         * Since baseUrl also includes /base, can just concatentate baseUrl + path\r\n         */\r\n        return `${baseUrl}${path}`;\r\n    }\r\n\r\n    private loginInteractively(url: string): Observable<boolean> {\r\n        if (this.msalGuardConfig.interactionType === InteractionType.Popup) {\r\n            this.authService.getLogger().verbose(\"Guard - logging in by popup\");\r\n            return this.authService.loginPopup({ ...this.msalGuardConfig.authRequest })\r\n                .pipe(\r\n                    map(() => {\r\n                        this.authService.getLogger().verbose(\"Guard - login by popup successful, can activate\");\r\n                        return true;\r\n                    }),\r\n                    catchError(() => of(false))\r\n                );\r\n        }\r\n\r\n        this.authService.getLogger().verbose(\"Guard - logging in by redirect\");\r\n        const redirectStartPage = this.getDestinationUrl(url);\r\n        this.authService.loginRedirect({\r\n            redirectStartPage,\r\n            ...this.msalGuardConfig.authRequest\r\n        });\r\n        return of(false);\r\n    }\r\n\r\n    canActivate(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): Observable<boolean> {\r\n        if (this.msalGuardConfig.interactionType !== InteractionType.Popup && this.msalGuardConfig.interactionType !== InteractionType.Redirect) {\r\n            throw new BrowserConfigurationAuthError(\"invalid_interaction_type\", \"Invalid interaction type provided to MSAL Guard. InteractionType.Popup or InteractionType.Redirect must be provided in the MsalGuardConfiguration\");\r\n        }\r\n        this.authService.getLogger().verbose(\"MSAL Guard activated\");\r\n\r\n        /*\r\n         * If a page with MSAL Guard is set as the redirect for acquireTokenSilent,\r\n         * short-circuit to prevent redirecting or popups.\r\n         * TODO: Update to allow running in iframe once allowRedirectInIframe is implemented\r\n         */\r\n        if (UrlString.hashContainsKnownProperties(window.location.hash) && BrowserUtils.isInIframe()) {\r\n            this.authService.getLogger().warning(\"Guard - redirectUri set to page with MSAL Guard. It is recommended to not set redirectUri to a page that requires authentication.\");\r\n            return of(false);\r\n        }\r\n\r\n        return this.authService.handleRedirectObservable()\r\n            .pipe(\r\n                concatMap(() => {\r\n                    if (!this.authService.instance.getAllAccounts().length) {\r\n                        this.authService.getLogger().verbose(\"Guard - no accounts retrieved, log in required to activate\");\r\n                        return this.loginInteractively(state.url);\r\n                    }\r\n                    this.authService.getLogger().verbose(\"Guard - account retrieved, can activate\");\r\n                    return of(true);\r\n                }),\r\n                catchError(() => {\r\n                    this.authService.getLogger().verbose(\"Guard - error while logging in, unable to activate\");\r\n                    return of(false);\r\n                })\r\n            );\r\n    }\r\n\r\n}\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport {\r\n    HttpRequest,\r\n    HttpHandler,\r\n    HttpEvent,\r\n    HttpInterceptor\r\n} from \"@angular/common/http\";\r\nimport { Observable, EMPTY } from \"rxjs\";\r\nimport { switchMap, catchError } from \"rxjs/operators\";\r\nimport { MsalService } from \"./msal.service\";\r\nimport { AuthenticationResult, BrowserConfigurationAuthError, InteractionType, StringUtils } from \"@azure/msal-browser\";\r\nimport { Injectable, Inject } from \"@angular/core\";\r\nimport { MSAL_INTERCEPTOR_CONFIG } from \"./constants\";\r\nimport { MsalInterceptorConfiguration } from \"./msal.interceptor.config\";\r\n\r\n@Injectable()\r\nexport class MsalInterceptor implements HttpInterceptor {\r\n    constructor(\r\n        @Inject(MSAL_INTERCEPTOR_CONFIG) private msalInterceptorConfig: MsalInterceptorConfiguration,\r\n        private authService: MsalService\r\n    ) {}\r\n\r\n    intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n        if (this.msalInterceptorConfig.interactionType !== InteractionType.Popup && this.msalInterceptorConfig.interactionType !== InteractionType.Redirect) {\r\n            throw new BrowserConfigurationAuthError(\"invalid_interaction_type\", \"Invalid interaction type provided to MSAL Interceptor. InteractionType.Popup, InteractionType.Redirect must be provided in the msalInterceptorConfiguration\");\r\n        }\r\n\r\n        this.authService.getLogger().verbose(\"MSAL Interceptor activated\");\r\n        const scopes = this.getScopesForEndpoint(req.url);\r\n        const account = this.authService.instance.getAllAccounts()[0];\r\n\r\n        if (!scopes || scopes.length === 0) {\r\n            this.authService.getLogger().verbose(\"Interceptor - no scopes for endpoint\");\r\n            return next.handle(req);\r\n        }\r\n\r\n        // Note: For MSA accounts, include openid scope when calling acquireTokenSilent to return idToken\r\n        return this.authService.acquireTokenSilent({...this.msalInterceptorConfig.authRequest, scopes, account})\r\n            .pipe(\r\n                catchError(() => {\r\n                    if (this.msalInterceptorConfig.interactionType === InteractionType.Popup) {\r\n                        this.authService.getLogger().verbose(\"Interceptor - error acquiring token silently, acquiring by popup\");\r\n                        return this.authService.acquireTokenPopup({...this.msalInterceptorConfig.authRequest, scopes});\r\n                    }\r\n                    this.authService.getLogger().verbose(\"Interceptor - error acquiring token silently, acquiring by redirect\");\r\n                    const redirectStartPage = window.location.href;\r\n                    this.authService.acquireTokenRedirect({...this.msalInterceptorConfig.authRequest, scopes, redirectStartPage});\r\n                    return EMPTY;\r\n                }),\r\n                switchMap((result: AuthenticationResult) => {\r\n                    this.authService.getLogger().verbose(\"Interceptor - setting authorization headers\");\r\n                    const headers = req.headers\r\n                        .set(\"Authorization\", `Bearer ${result.accessToken}`);\r\n\r\n                    const requestClone = req.clone({headers});\r\n                    return next.handle(requestClone);\r\n                })\r\n            );\r\n\r\n    }\r\n\r\n    private getScopesForEndpoint(endpoint: string): Array<string>|null {\r\n        this.authService.getLogger().verbose(\"Interceptor - getting scopes for endpoint\");\r\n        const protectedResourcesArray = Array.from(this.msalInterceptorConfig.protectedResourceMap.keys());\r\n        const keyMatchesEndpointArray = protectedResourcesArray.filter(key => {\r\n            return StringUtils.matchPattern(key, endpoint);\r\n        });\r\n\r\n        // process all protected resources and send the first matched resource\r\n        if (keyMatchesEndpointArray.length > 0) {\r\n            const keyForEndpoint = keyMatchesEndpointArray[0];\r\n            if (keyForEndpoint) {\r\n                return this.msalInterceptorConfig.protectedResourceMap.get(keyForEndpoint);\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n}\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { Inject, Injectable } from \"@angular/core\";\r\nimport { Observable, Subject } from \"rxjs\";\r\nimport { MSAL_INSTANCE } from \"./constants\";\r\nimport { EventMessage, IPublicClientApplication } from \"@azure/msal-browser\";\r\n\r\n@Injectable()\r\nexport class MsalBroadcastService {\r\n    private _msalSubject: Subject<EventMessage>;\r\n    public msalSubject$: Observable<EventMessage>;\r\n\r\n    constructor(\r\n        @Inject(MSAL_INSTANCE) private msalInstance: IPublicClientApplication\r\n    ) {\r\n        this._msalSubject = new Subject<EventMessage>();\r\n        this.msalSubject$  = this._msalSubject.asObservable();\r\n        this.msalInstance.addEventCallback((message: EventMessage) => {\r\n            this._msalSubject.next(message);\r\n        });\r\n    }\r\n}\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { ModuleWithProviders, NgModule } from \"@angular/core\";\r\nimport { CommonModule } from \"@angular/common\";\r\nimport { IPublicClientApplication } from \"@azure/msal-browser\";\r\nimport { MsalGuardConfiguration } from \"./msal.guard.config\";\r\nimport { MsalInterceptorConfiguration } from \"./msal.interceptor.config\";\r\nimport { MsalGuard } from \"./msal.guard\";\r\nimport { MsalBroadcastService } from \"./msal.broadcast.service\";\r\nimport { MsalService } from \"./msal.service\";\r\nimport { MSAL_INSTANCE , MSAL_GUARD_CONFIG, MSAL_INTERCEPTOR_CONFIG } from \"./constants\";\r\n\r\n@NgModule({\r\n    declarations: [],\r\n    imports: [\r\n        CommonModule\r\n    ],\r\n    providers: [\r\n        MsalGuard,\r\n        MsalBroadcastService\r\n    ]\r\n})\r\nexport class MsalModule {\r\n    static forRoot(\r\n        msalInstance: IPublicClientApplication,\r\n        guardConfig: MsalGuardConfiguration,\r\n        interceptorConfig: MsalInterceptorConfiguration\r\n    ): ModuleWithProviders<MsalModule> {\r\n        return {\r\n            ngModule: MsalModule,\r\n            providers: [\r\n                {\r\n                    provide: MSAL_INSTANCE,\r\n                    useValue: msalInstance\r\n                },\r\n                {\r\n                    provide: MSAL_GUARD_CONFIG,\r\n                    useValue: guardConfig\r\n                },\r\n                {\r\n                    provide: MSAL_INTERCEPTOR_CONFIG,\r\n                    useValue: interceptorConfig\r\n                },\r\n                MsalService\r\n            ]\r\n        };\r\n    }\r\n\r\n}\r\n","/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nexport { MsalService } from \"./msal.service\";\r\nexport { IMsalService } from \"./IMsalService\";\r\nexport { MsalGuard } from \"./msal.guard\";\r\nexport { MsalGuardConfiguration } from \"./msal.guard.config\";\r\nexport { MsalInterceptor } from \"./msal.interceptor\";\r\nexport { MsalInterceptorConfiguration } from \"./msal.interceptor.config\";\r\nexport { MSAL_INSTANCE, MSAL_GUARD_CONFIG, MSAL_INTERCEPTOR_CONFIG } from \"./constants\";\r\nexport { MsalBroadcastService } from \"./msal.broadcast.service\";\r\nexport { MsalModule } from \"./msal.module\";\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"]}