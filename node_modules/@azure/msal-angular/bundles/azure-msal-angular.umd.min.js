!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("rxjs"),require("@azure/msal-browser"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@azure/msal-angular",["exports","@angular/core","@angular/common","rxjs","@azure/msal-browser","rxjs/operators"],t):t(((e=e||self).azure=e.azure||{},e.azure["msal-angular"]={}),e.ng.core,e.ng.common,e.rxjs,e["@azure/msal-browser"],e.rxjs.operators)}(this,(function(e,t,r,n,o,i){"use strict";var a=new t.InjectionToken("MSAL_INSTANCE"),c=new t.InjectionToken("MSAL_GUARD_CONFIG"),s=new t.InjectionToken("MSAL_INTERCEPTOR_CONFIG"),u="@azure/msal-angular",p="2.0.0-alpha.0",g=function(){function e(e,t){this.instance=e,this.location=t;var r=this.location.path(!0).split("#").pop();r&&(this.redirectHash="#"+r)}return e.prototype.acquireTokenPopup=function(e){return n.from(this.instance.acquireTokenPopup(e))},e.prototype.acquireTokenRedirect=function(e){return n.from(this.instance.acquireTokenRedirect(e))},e.prototype.acquireTokenSilent=function(e){return n.from(this.instance.acquireTokenSilent(e))},e.prototype.handleRedirectObservable=function(){var e=n.from(this.instance.handleRedirectPromise(this.redirectHash));return this.redirectHash="",e},e.prototype.loginPopup=function(e){return n.from(this.instance.loginPopup(e))},e.prototype.loginRedirect=function(e){return n.from(this.instance.loginRedirect(e))},e.prototype.logout=function(e){return n.from(this.instance.logout(e))},e.prototype.ssoSilent=function(e){return n.from(this.instance.ssoSilent(e))},e.prototype.getLogger=function(){return this.logger||(this.logger=this.instance.getLogger().clone(u,p)),this.logger},e.prototype.setLogger=function(e){this.logger=e.clone(u,p),this.instance.setLogger(e)},e}();g.decorators=[{type:t.Injectable}],g.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[a]}]},{type:r.Location}]};var l=function(){function e(e,t,r){this.msalGuardConfig=e,this.authService=t,this.location=r}return e.prototype.getDestinationUrl=function(e){this.authService.getLogger().verbose("Guard - getting destination url");var t=document.getElementsByTagName("base"),r=this.location.normalize(t.length?t[0].href:window.location.origin),n=this.location.prepareExternalUrl(e);return n.startsWith("#")?(this.authService.getLogger().verbose("Guard - destination by hash routing"),r+"/"+n):""+r+e},e.prototype.loginInteractively=function(e){var t=this;if(this.msalGuardConfig.interactionType===o.InteractionType.Popup)return this.authService.getLogger().verbose("Guard - logging in by popup"),this.authService.loginPopup(Object.assign({},this.msalGuardConfig.authRequest)).pipe(i.map((function(){return t.authService.getLogger().verbose("Guard - login by popup successful, can activate"),!0})),i.catchError((function(){return n.of(!1)})));this.authService.getLogger().verbose("Guard - logging in by redirect");var r=this.getDestinationUrl(e);return this.authService.loginRedirect(Object.assign({redirectStartPage:r},this.msalGuardConfig.authRequest)),n.of(!1)},e.prototype.canActivate=function(e,t){var r=this;if(this.msalGuardConfig.interactionType!==o.InteractionType.Popup&&this.msalGuardConfig.interactionType!==o.InteractionType.Redirect)throw new o.BrowserConfigurationAuthError("invalid_interaction_type","Invalid interaction type provided to MSAL Guard. InteractionType.Popup or InteractionType.Redirect must be provided in the MsalGuardConfiguration");return this.authService.getLogger().verbose("MSAL Guard activated"),o.UrlString.hashContainsKnownProperties(window.location.hash)&&o.BrowserUtils.isInIframe()?(this.authService.getLogger().warning("Guard - redirectUri set to page with MSAL Guard. It is recommended to not set redirectUri to a page that requires authentication."),n.of(!1)):this.authService.handleRedirectObservable().pipe(i.concatMap((function(){return r.authService.instance.getAllAccounts().length?(r.authService.getLogger().verbose("Guard - account retrieved, can activate"),n.of(!0)):(r.authService.getLogger().verbose("Guard - no accounts retrieved, log in required to activate"),r.loginInteractively(t.url))})),i.catchError((function(){return r.authService.getLogger().verbose("Guard - error while logging in, unable to activate"),n.of(!1)})))},e}();l.decorators=[{type:t.Injectable}],l.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[c]}]},{type:g},{type:r.Location}]};var h=function(){function e(e,t){this.msalInterceptorConfig=e,this.authService=t}return e.prototype.intercept=function(e,t){var r=this;if(this.msalInterceptorConfig.interactionType!==o.InteractionType.Popup&&this.msalInterceptorConfig.interactionType!==o.InteractionType.Redirect)throw new o.BrowserConfigurationAuthError("invalid_interaction_type","Invalid interaction type provided to MSAL Interceptor. InteractionType.Popup, InteractionType.Redirect must be provided in the msalInterceptorConfiguration");this.authService.getLogger().verbose("MSAL Interceptor activated");var a=this.getScopesForEndpoint(e.url),c=this.authService.instance.getAllAccounts()[0];return a&&0!==a.length?this.authService.acquireTokenSilent(Object.assign(Object.assign({},this.msalInterceptorConfig.authRequest),{scopes:a,account:c})).pipe(i.catchError((function(){if(r.msalInterceptorConfig.interactionType===o.InteractionType.Popup)return r.authService.getLogger().verbose("Interceptor - error acquiring token silently, acquiring by popup"),r.authService.acquireTokenPopup(Object.assign(Object.assign({},r.msalInterceptorConfig.authRequest),{scopes:a}));r.authService.getLogger().verbose("Interceptor - error acquiring token silently, acquiring by redirect");var e=window.location.href;return r.authService.acquireTokenRedirect(Object.assign(Object.assign({},r.msalInterceptorConfig.authRequest),{scopes:a,redirectStartPage:e})),n.EMPTY})),i.switchMap((function(n){r.authService.getLogger().verbose("Interceptor - setting authorization headers");var o=e.headers.set("Authorization","Bearer "+n.accessToken),i=e.clone({headers:o});return t.handle(i)}))):(this.authService.getLogger().verbose("Interceptor - no scopes for endpoint"),t.handle(e))},e.prototype.getScopesForEndpoint=function(e){this.authService.getLogger().verbose("Interceptor - getting scopes for endpoint");var t=Array.from(this.msalInterceptorConfig.protectedResourceMap.keys()).filter((function(t){return o.StringUtils.matchPattern(t,e)}));if(t.length>0){var r=t[0];if(r)return this.msalInterceptorConfig.protectedResourceMap.get(r)}return null},e}();h.decorators=[{type:t.Injectable}],h.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[s]}]},{type:g}]};var d=function(e){var t=this;this.msalInstance=e,this._msalSubject=new n.Subject,this.msalSubject$=this._msalSubject.asObservable(),this.msalInstance.addEventCallback((function(e){t._msalSubject.next(e)}))};d.decorators=[{type:t.Injectable}],d.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[a]}]}]};var f=function(){function e(){}return e.forRoot=function(t,r,n){return{ngModule:e,providers:[{provide:a,useValue:t},{provide:c,useValue:r},{provide:s,useValue:n},g]}},e}();f.decorators=[{type:t.NgModule,args:[{declarations:[],imports:[r.CommonModule],providers:[l,d]}]}],e.MSAL_GUARD_CONFIG=c,e.MSAL_INSTANCE=a,e.MSAL_INTERCEPTOR_CONFIG=s,e.MsalBroadcastService=d,e.MsalGuard=l,e.MsalInterceptor=h,e.MsalModule=f,e.MsalService=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=azure-msal-angular.umd.min.js.map